<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EchoTune AI Analytics Dashboard</title>
    <meta name="description" content="Discover insights about your music listening habits and preferences">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- Chart.js for data visualization -->
    <script src="/chart.min.js"></script>
    
    <style>
        :root {
            --primary-color: #1db954;
            --primary-dark: #1ed760;
            --secondary-color: #191414;
            --background-dark: #121212;
            --background-light: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --error-color: #e22134;
            --success-color: #1db954;
            --warning-color: #f39c12;
            --border-radius: 12px;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            --gradient-background: linear-gradient(135deg, var(--background-dark) 0%, var(--secondary-color) 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--gradient-background);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            padding: 40px 0;
            background: rgba(25, 20, 20, 0.8);
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .nav-breadcrumb {
            margin-bottom: 20px;
            padding: 15px 20px;
            background: var(--background-light);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-breadcrumb a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .nav-breadcrumb a:hover {
            color: var(--primary-dark);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--background-light);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            text-align: center;
            transition: transform 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: var(--background-light);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        .insights-section {
            background: var(--background-light);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 30px;
        }

        .insights-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insight-item {
            padding: 15px;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }

        .insight-item h4 {
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .insight-item p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .error-state {
            text-align: center;
            padding: 60px 20px;
            background: var(--background-light);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .error-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.6;
        }

        .error-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .error-message {
            color: var(--text-secondary);
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .action-button {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(29, 185, 84, 0.3);
        }

        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            background: var(--background-light);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(29, 185, 84, 0.3);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .demo-notice {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning-color);
            padding: 15px 20px;
            border-radius: var(--border-radius);
            border: 1px solid var(--warning-color);
            margin-bottom: 20px;
            text-align: center;
        }

        .audio-features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .feature-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .feature-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .feature-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        @media (max-width: 768px) {
            .dashboard-container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .chart-wrapper {
                height: 250px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .audio-features-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="nav-breadcrumb">
            <a href="/">üè† Home</a>
            <span>‚Üí</span>
            <span>üìä Analytics Dashboard</span>
        </div>

        <div class="header">
            <h1>üìä Music Analytics Dashboard</h1>
            <p>Discover insights about your listening habits and musical preferences</p>
        </div>

        <div class="demo-notice" id="demoNotice">
            <strong>üé≠ Demo Mode:</strong> This dashboard shows sample data. Connect your Spotify account to see your real listening analytics!
        </div>

        <!-- Loading State -->
        <div class="loading-state" id="loadingState">
            <div class="loading-spinner"></div>
            <h3>Loading your music analytics...</h3>
            <p>Analyzing your listening patterns and preferences</p>
        </div>

        <!-- Error State -->
        <div class="error-state hidden" id="errorState">
            <div class="error-icon">üéµ</div>
            <h2 class="error-title">No Music Data Available</h2>
            <p class="error-message">
                To see your personalized music analytics, you need to connect your Spotify account. 
                We'll analyze your listening history to provide insights about your musical preferences, 
                favorite genres, and listening patterns.
            </p>
            <a href="/auth/spotify" class="action-button">
                üéµ Connect Spotify Account
            </a>
        </div>

        <!-- Dashboard Content -->
        <div class="dashboard-content hidden" id="dashboardContent">
            <!-- Quick Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalTracks">1,247</div>
                    <div class="stat-label">Total Tracks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalArtists">312</div>
                    <div class="stat-label">Unique Artists</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalGenres">18</div>
                    <div class="stat-label">Genres Explored</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="listeningTime">142h</div>
                    <div class="stat-label">Total Listening Time</div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-grid">
                <div class="chart-container">
                    <h3 class="chart-title">üé® Top Genres</h3>
                    <div class="chart-wrapper">
                        <canvas id="genreChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <h3 class="chart-title">‚è∞ Listening Activity</h3>
                    <div class="chart-wrapper">
                        <canvas id="activityChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <h3 class="chart-title">üéµ Audio Features Profile</h3>
                    <div class="chart-wrapper">
                        <canvas id="audioFeaturesChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <h3 class="chart-title">üìà Discovery Timeline</h3>
                    <div class="chart-wrapper">
                        <canvas id="discoveryChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Insights Section -->
            <div class="insights-section">
                <h3 class="insights-title">üí° Personalized Insights</h3>
                
                <div class="insight-item">
                    <h4>Your Musical DNA</h4>
                    <p>You have a diverse taste spanning multiple genres, with a strong preference for energetic tracks (average energy: 0.72). Your music tends to be upbeat and positive (valence: 0.68).</p>
                </div>

                <div class="insight-item">
                    <h4>Peak Listening Times</h4>
                    <p>You're most active listening to music during evening hours (6-9 PM) and have consistent discovery patterns on weekends when you explore new artists.</p>
                </div>

                <div class="insight-item">
                    <h4>Discovery Patterns</h4>
                    <p>You discover 23% new music monthly, showing good balance between exploring fresh content and enjoying familiar favorites. Your discovery rate is above average!</p>
                </div>

                <div class="insight-item">
                    <h4>Mood-Based Listening</h4>
                    <p>Your playlist choices show adaptive mood matching - more energetic music during workouts and calmer tracks during focus sessions. This suggests good emotional intelligence in music selection.</p>
                </div>

                <!-- Audio Features Breakdown -->
                <div class="audio-features-grid">
                    <div class="feature-item">
                        <div class="feature-value">0.72</div>
                        <div class="feature-label">Energy</div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-value">0.68</div>
                        <div class="feature-label">Valence</div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-value">0.65</div>
                        <div class="feature-label">Danceability</div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-value">0.31</div>
                        <div class="feature-label">Acousticness</div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-value">0.15</div>
                        <div class="feature-label">Speechiness</div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-value">128</div>
                        <div class="feature-label">Avg Tempo</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class MusicAnalyticsDashboard {
            constructor() {
                this.charts = {};
                this.userData = null;
                this.isDemo = true;
                this.init();
            }

            async init() {
                this.showLoading();
                
                try {
                    // Check if user is authenticated
                    const authStatus = await this.checkAuthentication();
                    
                    if (authStatus.authenticated) {
                        await this.loadUserData();
                        this.isDemo = false;
                        document.getElementById('demoNotice').style.display = 'none';
                    } else {
                        // Load demo data after a short delay
                        setTimeout(() => {
                            this.loadDemoData();
                        }, 2000);
                    }
                } catch (error) {
                    console.error('Dashboard initialization error:', error);
                    this.showError();
                }
            }

            showLoading() {
                document.getElementById('loadingState').classList.remove('hidden');
                document.getElementById('dashboardContent').classList.add('hidden');
                document.getElementById('errorState').classList.add('hidden');
            }

            showError() {
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('dashboardContent').classList.add('hidden');
                document.getElementById('errorState').classList.remove('hidden');
            }

            showDashboard() {
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('errorState').classList.add('hidden');
                document.getElementById('dashboardContent').classList.remove('hidden');
            }

            async checkAuthentication() {
                // In a real implementation, this would check for valid Spotify tokens
                const userData = localStorage.getItem('echotune_user');
                return {
                    authenticated: !!userData,
                    user: userData ? JSON.parse(userData) : null
                };
            }

            async loadUserData() {
                // This would load real user data from Spotify API
                // For now, we'll show demo data
                this.loadDemoData();
            }

            loadDemoData() {
                this.userData = {
                    totalTracks: 1247,
                    totalArtists: 312,
                    totalGenres: 18,
                    listeningTime: '142h',
                    topGenres: [
                        { name: 'Pop', count: 245, percentage: 19.6 },
                        { name: 'Rock', count: 198, percentage: 15.9 },
                        { name: 'Electronic', count: 156, percentage: 12.5 },
                        { name: 'Hip Hop', count: 134, percentage: 10.7 },
                        { name: 'Indie', count: 112, percentage: 9.0 },
                        { name: 'Alternative', count: 89, percentage: 7.1 }
                    ],
                    listeningActivity: [
                        { hour: 6, plays: 12 }, { hour: 7, plays: 28 }, { hour: 8, plays: 45 },
                        { hour: 9, plays: 67 }, { hour: 10, plays: 54 }, { hour: 11, plays: 62 },
                        { hour: 12, plays: 78 }, { hour: 13, plays: 85 }, { hour: 14, plays: 72 },
                        { hour: 15, plays: 89 }, { hour: 16, plays: 95 }, { hour: 17, plays: 112 },
                        { hour: 18, plays: 134 }, { hour: 19, plays: 156 }, { hour: 20, plays: 142 },
                        { hour: 21, plays: 98 }, { hour: 22, plays: 76 }, { hour: 23, plays: 45 }
                    ],
                    audioFeatures: {
                        energy: 0.72,
                        valence: 0.68,
                        danceability: 0.65,
                        acousticness: 0.31,
                        speechiness: 0.15,
                        instrumentalness: 0.08
                    },
                    discoveryTimeline: [
                        { month: 'Jan', newArtists: 23, newTracks: 145 },
                        { month: 'Feb', newArtists: 18, newTracks: 112 },
                        { month: 'Mar', newArtists: 31, newTracks: 198 },
                        { month: 'Apr', newArtists: 25, newTracks: 156 },
                        { month: 'May', newArtists: 29, newTracks: 187 },
                        { month: 'Jun', newArtists: 22, newTracks: 134 }
                    ]
                };

                this.updateDashboard();
                this.showDashboard();
                this.createCharts();
            }

            updateDashboard() {
                // Update stats
                document.getElementById('totalTracks').textContent = this.userData.totalTracks.toLocaleString();
                document.getElementById('totalArtists').textContent = this.userData.totalArtists.toLocaleString();
                document.getElementById('totalGenres').textContent = this.userData.totalGenres;
                document.getElementById('listeningTime').textContent = this.userData.listeningTime;
            }

            createCharts() {
                this.createGenreChart();
                this.createActivityChart();
                this.createAudioFeaturesChart();
                this.createDiscoveryChart();
            }

            createGenreChart() {
                const ctx = document.getElementById('genreChart');
                this.charts.genre = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: this.userData.topGenres.map(g => g.name),
                        datasets: [{
                            data: this.userData.topGenres.map(g => g.count),
                            backgroundColor: [
                                '#1db954', '#1ed760', '#1aa34a', '#16873d',
                                '#126b30', '#0e4f23'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#b3b3b3',
                                    padding: 20,
                                    usePointStyle: true
                                }
                            }
                        }
                    }
                });
            }

            createActivityChart() {
                const ctx = document.getElementById('activityChart');
                this.charts.activity = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: this.userData.listeningActivity.map(a => `${a.hour}:00`),
                        datasets: [{
                            label: 'Plays',
                            data: this.userData.listeningActivity.map(a => a.plays),
                            borderColor: '#1db954',
                            backgroundColor: 'rgba(29, 185, 84, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: '#b3b3b3'
                                }
                            },
                            y: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: '#b3b3b3'
                                }
                            }
                        }
                    }
                });
            }

            createAudioFeaturesChart() {
                const ctx = document.getElementById('audioFeaturesChart');
                const features = this.userData.audioFeatures;
                
                this.charts.audioFeatures = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['Energy', 'Valence', 'Danceability', 'Acousticness', 'Speechiness', 'Instrumentalness'],
                        datasets: [{
                            label: 'Your Profile',
                            data: [
                                features.energy,
                                features.valence,
                                features.danceability,
                                features.acousticness,
                                features.speechiness,
                                features.instrumentalness
                            ],
                            borderColor: '#1db954',
                            backgroundColor: 'rgba(29, 185, 84, 0.2)',
                            pointBackgroundColor: '#1db954',
                            pointBorderColor: '#ffffff',
                            pointHoverBackgroundColor: '#ffffff',
                            pointHoverBorderColor: '#1db954'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 1,
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                pointLabels: {
                                    color: '#b3b3b3'
                                },
                                ticks: {
                                    color: '#b3b3b3',
                                    backdropColor: 'transparent'
                                }
                            }
                        }
                    }
                });
            }

            createDiscoveryChart() {
                const ctx = document.getElementById('discoveryChart');
                this.charts.discovery = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: this.userData.discoveryTimeline.map(d => d.month),
                        datasets: [{
                            label: 'New Artists',
                            data: this.userData.discoveryTimeline.map(d => d.newArtists),
                            backgroundColor: '#1db954',
                            borderRadius: 4
                        }, {
                            label: 'New Tracks',
                            data: this.userData.discoveryTimeline.map(d => d.newTracks),
                            backgroundColor: '#1ed760',
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#b3b3b3',
                                    usePointStyle: true
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: '#b3b3b3'
                                }
                            },
                            y: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: '#b3b3b3'
                                }
                            }
                        }
                    }
                });
            }
        }

        // Add CSS utility class
        const style = document.createElement('style');
        style.textContent = '.hidden { display: none !important; }';
        document.head.appendChild(style);

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new MusicAnalyticsDashboard();
        });
    </script>
</body>
</html>